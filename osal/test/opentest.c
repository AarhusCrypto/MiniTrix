#include <osal.h>
#include <stdio.h>


int main(int c, char **a) {
  OE oe = OperatingEnvironment_LinuxNew();
  uint fd = 0;
  byte b[128] = {0};
  uint lb = sizeof(b)-1;
  RC rc = 0;

  
  fd = oe->open("ip 127.0.0.1 2020");
  if (!fd) {
    oe->p("Failed to open ip address");
  } else {
    oe->p("Ip address opened");
  }

  rc = oe->read(fd, b, &lb);
  if (rc != RC_OK) {
    oe->p("Failed to read from file descriptor");
  } else {
    oe->p("Yeah ! we read data");
    printf("%s",b);
  }
  

  if (oe->close(fd) < 0) {
    oe->p("Failed to close fd");
  } else {
    oe->p("Yeah ! fd also closed");
  }

  fd = oe->open("file config.h");
  if (!fd) {
    oe->p("Oh no, failed to open file");
  } else {
    oe->p("yeah ! opened file");
  }

  rc = oe->read(fd, b, &lb);
  if (rc != RC_OK) {
    oe->p("Failed to read from file.");
  } else {
    oe->p("Oh, yead we are in business reading files.");
  }

  rc = oe->write(fd, (byte*)"# Rasmus", 8);
  if (rc != RC_OK) {
    oe->p("Write failed");
  } else {
    oe->p("That's it we are in the game");
  }

  if (oe->close(fd) < 0) {
    oe->p("Damn it ,failed to close file");
  } else {
    oe->p("Closed file properly :)");
  }

  fd = oe->open("listen 2020");
  if (!fd) {
    oe->p("Unable to listen on port 2020");
  } else {
    oe->p("Accepting connections on 2020");
  }

  oe->close(fd);

  OperatingEnvironment_LinuxDestroy( & oe );
}
